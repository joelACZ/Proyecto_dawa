<app-card
  title="Gestión de Reseñas"
  subtitle="Administra las reseñas creadas por los usuarios"
  content="Aquí puedes visualizar, editar y eliminar reseñas realizadas sobre los servicios prestados."
>
</app-card>

<div class="mb-4 mt-4 d-flex align-items-center gap-2">
  <input type="text" placeholder="Buscar reseñas..." class="border p-2 rounded w-full md:w-64" #txtBuscar />
  <div style="margin-left: auto" class="d-flex gap-2">
    <button class="btn btn-light border font-weight-bold py-2 px-4 rounded transition" (click)="abrirNuevo()">+ Nueva Reseña</button>
    <button class="btn btn-light border font-weight-bold py-2 px-4 rounded transition" (click)="navegarAListaResenas()"><i class="bi bi-list-ul me-1"></i> Lista de Reseñas</button>
  </div>
</div>

<app-data-table
  [data]="resenasPaginadas"
  [columns]="[
    { field: 'id', header: 'ID' },
    { field: 'servicio_nombre', header: 'Servicio' },
    { field: 'calificacionFormateada', header: 'Calificación' },
    { field: 'comentario', header: 'Comentario' },
    { field: 'fecha', header: 'Fecha' },
    { field: 'anonimaFormateada', header: 'Anónima' }
  ]"
>
  <ng-template #actions let-row>
    <div class="d-flex gap-2">
      <button (click)="verDetalle(row)" class="btn action-btn unified"><i class="bi bi-eye"></i></button>
      <button (click)="abrirEdicion(row)" class="btn action-btn unified"><i class="bi bi-pencil"></i></button>
      <button (click)="abrirModalEliminar(row)" class="btn action-btn unified"><i class="bi bi-trash"></i></button>
    </div>
  </ng-template>
</app-data-table>

<div class="modal fade" id="resenaModal" #elementoModal>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">{{ resenaEnEdicion ? 'Editar' : 'Nueva' }} Reseña</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <form [formGroup]="formResena">
        <div class="modal-body">
          
          <div class="mb-3">
            <label class="form-label fw-bold">Servicio *</label>
            <select class="form-select" formControlName="servicio_id">
              <option value="">Seleccionar servicio...</option>
              <option *ngFor="let s of servicios" [value]="s.id">{{ s.nombre }}</option>
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label fw-bold">Cliente *</label>
            <select class="form-select" formControlName="cliente_id">
              <option value="">Seleccionar cliente...</option>
              <option *ngFor="let c of clientes" [value]="c.id">{{ c.nombre }}</option>
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label fw-bold">Calificación *</label>
            <select class="form-select" formControlName="calificacion">
              <option value="">Seleccionar</option>
              <option *ngFor="let o of opcionesCalificacion" [value]="o.valor">{{ o.texto }}</option>
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label fw-bold">Comentario *</label>
            <textarea class="form-control" rows="4" formControlName="comentario"></textarea>
          </div>

          <div class="mb-3">
            <label class="form-label fw-bold">Fecha *</label>
            <input type="date" class="form-control" formControlName="fecha" />
          </div>

          <div class="form-check">
            <input class="form-check-input" type="checkbox" formControlName="anonima" id="checkAnonima" />
            <label class="form-check-label" for="checkAnonima">Reseña anónima</label>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="cerrarModalPrincipal()">Cancelar</button>
          <button type="button" class="btn btn-primary" (click)="guardarResena()">{{ resenaEnEdicion ? 'Actualizar' : 'Guardar' }}</button>
        </div>
      </form>
    </div>
  </div>
</div>