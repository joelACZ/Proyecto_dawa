<h1 class="text-2xl font-bold mb-6">Gestión de Reseñas</h1>

<app-card
  title="Gestión de Reseñas"
  subtitle="Administra las reseñas creadas por los usuarios"
  content="Aquí puedes visualizar, editar y eliminar reseñas realizadas sobre los servicios prestados.">
</app-card>

<div class="mb-4 mt-4 flex justify-between items-center gap-2">
  <input type="text" placeholder="Buscar reseñas..." class="border p-2 rounded w-full md:w-64" #txtBuscar (input)="search(txtBuscar)" />
  <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition" (click)="openNew()">
    + Nueva Reseña
  </button>
</div>

<app-data-table [data]="resenasParaTabla" [columns]="[
  { field: 'id', header: 'ID' },
  { field: 'solicitud_id', header: 'Solicitud ID' },
  { field: 'calificacionFormateada', header: 'Calificación' },
  { field: 'comentario', header: 'Comentario' },
  { field: 'fecha', header: 'Fecha' },
  { field: 'anonimaFormateada', header: 'Anónima' }
]">
  <ng-template #actions let-row>
    <div class="flex space-x-2">
      <button class="text-blue-600 border border-blue-600 px-3 py-1 rounded hover:bg-blue-50" (click)="view(row)">Ver</button>
      <button class="text-yellow-600 border border-yellow-600 px-3 py-1 rounded hover:bg-yellow-50" (click)="openEdit(row)">Editar</button>
      <button class="text-red-600 border border-red-600 px-3 py-1 rounded hover:bg-red-50" (click)="openDeleteModal(row)">Eliminar</button>
    </div>
  </ng-template>
</app-data-table>

<!-- MODAL REUTILIZABLE DE DETALLES (TU DetailModal SIN CAMBIAR NADA) -->
<app-detail-modal
  [isVisible]="showDetailModal"
  [data]="resenaDetalle"
  (close)="closeDetail()">
</app-detail-modal>

<!-- Los demás modales (notificación, error, eliminar, crear/editar) se quedan exactamente como los tenías -->
<!-- (Solo copié los importantes para que no se pierdan) -->

<div *ngIf="showNotificationModal" class="modal fade show d-block" style="background:rgba(0,0,0,0.5)">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body text-center">
        <h5>Éxito</h5>
        <p>{{ notificationMessage }}</p>
        <button class="btn btn-success" (click)="showNotificationModal = false">Aceptar</button>
      </div>
    </div>
  </div>
</div>

<div *ngIf="showErrorModal" class="modal fade show d-block" style="background:rgba(0,0,0,0.5)">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body text-center text-danger">
        <h5>Error</h5>
        <p>{{ errorMessage }}</p>
        <button class="btn btn-danger" (click)="showErrorModal = false">Aceptar</button>
      </div>
    </div>
  </div>
</div>

<div *ngIf="showDeleteModal" class="modal fade show d-block" style="background:rgba(0,0,0,0.5)">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body text-center">
        <h5 class="text-danger">¿Eliminar reseña #{{ resenaAEliminar?.id }}?</h5>
        <p>"{{ resenaAEliminar?.comentario }}"</p>
        <button class="btn btn-secondary me-2" (click)="closeDeleteModal()">Cancelar</button>
        <button class="btn btn-danger" (click)="confirmDelete()">Eliminar</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal crear/editar (Bootstrap) -->
<div class="modal fade" id="resenaModal" #resenaModal>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{ resenaEdit ? 'Editar' : 'Nueva' }} Reseña</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <form [formGroup]="formResena" (ngSubmit)="save()">
        <div class="modal-body">
          <!-- Tus campos del formulario (igual que antes) -->
          <div class="mb-3">
            <label>ID Solicitud *</label>
            <input type="number" class="form-control" formControlName="solicitud_id">
          </div>
          <div class="mb-3">
            <label>Calificación *</label>
            <select class="form-select" formControlName="calificacion">
              <option value="">Seleccionar</option>
              <option *ngFor="let o of opcionesCalificacion" [value]="o.valor">{{ o.texto }}</option>
            </select>
          </div>
          <div class="mb-3">
            <label>Comentario *</label>
            <textarea class="form-control" rows="4" formControlName="comentario"></textarea>
          </div>
          <div class="mb-3">
            <label>Fecha *</label>
            <input type="date" class="form-control" formControlName="fecha">
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" formControlName="anonima">
            <label class="form-check-label">Anónima</label>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="modalRef.hide()">Cancelar</button>
          <button type="submit" class="btn btn-primary">{{ resenaEdit ? 'Actualizar' : 'Guardar' }}</button>
        </div>
      </form>
    </div>
  </div>
</div>