
<app-card
  title="Gestión de Clientes"
  subtitle="Administra los clientes registrados en la plataforma"
  content="Aquí puedes visualizar, editar y eliminar clientes, así como gestionar sus datos personales y preferencias.">
</app-card>


<div class="card mb-4">
  <div class="card-body">
    <div class="row g-3 align-items-center">
      <div class="col-12 col-md-8">
        <div class="input-group">
          <span class="input-group-text"><i class="bi bi-search"></i></span>
          <input type="text" 
                 placeholder="Buscar clientes por nombre o email..."
                 class="form-control"
                 #txtBuscar 
                 (input)="buscarClientes(txtBuscar)" />
        </div>
      </div>
      <div class="col-12 col-md-4 text-md-end">
          <button class="btn btn-outline-dark" (click)="abrirModalNuevo()">
          <i class="bi bi-person-plus"></i> Nuevo Cliente
        </button>
      </div>
    </div>
  </div>
</div>


<div class="card mb-4" *ngIf="false">
  <div class="card-header bg-light">
    <h5 class="mb-0">
      <i class="bi bi-funnel me-2"></i>Filtros de Búsqueda
    </h5>
  </div>
  <div class="card-body">
    
  </div>
</div>


<div class="card">
  <div class="card-body p-0">
    <app-data-table [data]="obtenerClientesPaginados" [columns]="[
      { field: 'id', header: 'ID' },
      { field: 'nombre', header: 'Nombre' },
      { field: 'email', header: 'Email' },
      { field: 'telefono', header: 'Teléfono' },
      { field: 'direccion', header: 'Dirección' },
      { field: 'preferenciasFormateadas', header: 'Preferencias' },
      { field: 'notificacionesFormateada', header: 'Notificaciones' }
    ]">
      <ng-template #actions let-row>
        <div class="btn-group btn-group-sm" role="group">
          <button (click)="verDetalleCliente(row)" class="btn action-btn unified" title="Ver detalle">
            <i class="bi bi-eye"></i>
          </button>
          <button (click)="abrirModalEdicion(row)" class="btn action-btn unified" title="Editar">
            <i class="bi bi-pencil"></i>
          </button>
          <button (click)="abrirModalEliminacion(row)" class="btn action-btn unified" title="Eliminar">
            <i class="bi bi-trash"></i>
          </button>
        </div>
      </ng-template>
    </app-data-table>
  </div>
</div>


<div class="card mt-3" *ngIf="totalPaginas > 1">
  <div class="card-body">
    <div class="row align-items-center">
      <div class="col-md-6 text-center text-md-start mb-2 mb-md-0">
         
      </div>
      <div class="col-md-6">
        <nav aria-label="Paginación de clientes">
          <ul class="pagination justify-content-center justify-content-md-center mb-0">
            
            <li class="page-item" [class.disabled]="paginaActual === 1">
              <a class="page-link" href="#" (click)="cambiarPagina(paginaActual - 1); $event.preventDefault()">
                <i class="bi bi-chevron-left"></i> Anterior
              </a>
            </li>
            
            
            <li class="page-item" *ngFor="let pagina of [].constructor(totalPaginas); let i = index"
                [class.active]="paginaActual === i + 1">
              <a class="page-link" href="#" (click)="cambiarPagina(i + 1); $event.preventDefault()">
                {{ i + 1 }}
              </a>
            </li>
            
            
            <li class="page-item" [class.disabled]="paginaActual === totalPaginas">
              <a class="page-link" href="#" (click)="cambiarPagina(paginaActual + 1); $event.preventDefault()">
                Siguiente <i class="bi bi-chevron-right"></i>
              </a>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
</div>


<app-detail-modal
  [isVisible]="mostrarModalDetalle"
  [data]="clienteDetalle"
  (close)="cerrarModalDetalle()">
</app-detail-modal>


<div *ngIf="mostrarModalNotificacion" class="modal fade show d-block" tabindex="-1" style="background-color: rgba(0,0,0,0.5);">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg">
      <div class="modal-header bg-success text-white border-0">
        <button type="button" class="btn-close btn-close-white" (click)="mostrarModalNotificacion = false"></button>
      </div>
      <div class="modal-body text-center py-4">
        <div class="modal-icon mb-3">
          <i class="bi bi-check-circle-fill text-success" style="font-size: 3rem;"></i>
        </div>
        <h5 class="modal-title mb-3">¡Éxito!</h5>
        <p class="mb-0">{{ mensajeNotificacion }}</p>
      </div>
      <div class="modal-footer border-0 justify-content-center">
        <button type="button" class="btn btn-success px-4" (click)="mostrarModalNotificacion = false">
          Aceptar
        </button>
      </div>
    </div>
  </div>
</div>

<div *ngIf="mostrarModalError" class="modal fade show d-block" tabindex="-1" style="background-color: rgba(0,0,0,0.5);">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg">
      <div class="modal-header bg-danger text-white border-0">
        <button type="button" class="btn-close btn-close-white" (click)="mostrarModalError = false"></button>
      </div>
      <div class="modal-body text-center py-4">
        <div class="modal-icon mb-3">
          <i class="bi bi-exclamation-triangle-fill text-danger" style="font-size: 3rem;"></i>
        </div>
        <h5 class="modal-title mb-3">Error</h5>
        <p class="mb-0">{{ mensajeError }}</p>
      </div>
      <div class="modal-footer border-0 justify-content-center">
        <button type="button" class="btn btn-danger px-4" (click)="mostrarModalError = false">
          Aceptar
        </button>
      </div>
    </div>
  </div>
</div>


<div *ngIf="mostrarModalEliminar" class="modal fade show d-block" tabindex="-1" style="background-color: rgba(0,0,0,0.5);">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow">
      <div class="modal-header bg-danger text-white border-0">
        <h5 class="modal-title">
          <i class="bi bi-exclamation-triangle me-2"></i>
          Confirmar Eliminación
        </h5>
        <button type="button" class="btn-close btn-close-white" (click)="cerrarModalEliminacion()"></button>
      </div>
      <div class="modal-body text-center py-4">
        <div class="mb-4">
          <i class="bi bi-trash3-fill text-danger" style="font-size: 3rem;"></i>
        </div>
        <h6 class="mb-3">¿Está seguro de eliminar al cliente #{{ clienteAEliminar?.id }}?</h6>
        <div class="alert alert-light border">
          <p class="mb-1"><strong>Cliente:</strong></p>
          <p class="mb-0 text-muted">{{ clienteAEliminar?.nombre }} ({{ clienteAEliminar?.email }})</p>
        </div>
        <p class="text-danger small mt-3 mb-0">
          <i class="bi bi-exclamation-circle-fill me-1"></i>
          Esta acción no se puede deshacer.
        </p>
      </div>
      <div class="modal-footer border-0 justify-content-center">
        <button type="button" class="btn btn-secondary me-3 px-3" (click)="cerrarModalEliminacion()">
          <i class="bi bi-x-circle me-1"></i> Cancelar
        </button>
        <button type="button" class="btn btn-danger px-3" (click)="confirmarEliminacion()">
          <i class="bi bi-trash3 me-1"></i> Sí, eliminar
        </button>
      </div>
    </div>
  </div>
</div>


<div class="modal fade" id="clienteModal" #clienteModal>
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title fw-bold">
          {{ clienteEnEdicion ? 'Editar' : 'Nuevo' }} Cliente
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <form [formGroup]="formularioCliente">
        <div class="modal-body">
          
          <div class="mb-3">
            <label class="form-label fw-semibold">Nombre *</label>
            <input type="text" class="form-control" formControlName="nombre" placeholder="Nombre completo">
            <div class="form-text text-danger" *ngIf="formularioCliente.get('nombre')?.invalid &&
                  (formularioCliente.get('nombre')?.dirty || formularioCliente.get('nombre')?.touched)">
              <small>
                <i class="bi bi-exclamation-circle-fill me-1"></i>
                <span *ngIf="formularioCliente.get('nombre')?.errors?.['required']">El nombre es obligatorio.</span>
                <span *ngIf="formularioCliente.get('nombre')?.errors?.['minlength']">El nombre debe tener al menos 2 caracteres.</span>
              </small>
            </div>
          </div>

          
          <div class="mb-3">
            <label class="form-label fw-semibold">Email *</label>
            <input type="email" class="form-control" formControlName="email" placeholder="correo@ejemplo.com">
            <div class="form-text text-danger" *ngIf="formularioCliente.get('email')?.invalid &&
                  (formularioCliente.get('email')?.dirty || formularioCliente.get('email')?.touched)">
              <small>
                <i class="bi bi-exclamation-circle-fill me-1"></i>
                <span *ngIf="formularioCliente.get('email')?.errors?.['required']">El email es obligatorio.</span>
                <span *ngIf="formularioCliente.get('email')?.errors?.['email']">Ingrese un email válido.</span>
              </small>
            </div>
          </div>

          
          <div class="mb-3">
            <label class="form-label fw-semibold">Teléfono *</label>
            <input type="tel" class="form-control" formControlName="telefono" placeholder="1234567890">
            <div class="form-text text-danger" *ngIf="formularioCliente.get('telefono')?.invalid &&
                  (formularioCliente.get('telefono')?.dirty || formularioCliente.get('telefono')?.touched)">
              <small>
                <i class="bi bi-exclamation-circle-fill me-1"></i>
                <span *ngIf="formularioCliente.get('telefono')?.errors?.['required']">El teléfono es obligatorio.</span>
                <span *ngIf="formularioCliente.get('telefono')?.errors?.['pattern']">Ingrese un número de teléfono válido.</span>
              </small>
            </div>
          </div>

          
          <div class="mb-3">
            <label class="form-label fw-semibold">Dirección</label>
            <input type="text" class="form-control" formControlName="direccion" placeholder="Dirección completa">
          </div>

          
          <div class="mb-3">
            <label class="form-label fw-semibold">Preferencias</label>
            <input type="text" class="form-control" formControlName="preferencias" 
                   placeholder="Ej: Electricidad, Plomería, Urgente">
            <small class="form-text text-muted">
              <i class="bi bi-info-circle me-1"></i>
              Separe las preferencias con comas
            </small>
          </div>

          
          <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" formControlName="notificaciones" id="checkNotificaciones">
            <label class="form-check-label" for="checkNotificaciones">
              <i class="bi bi-bell me-1"></i>
              Recibir notificaciones
            </label>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="cerrarModalPrincipal()">
            <i class="bi bi-x-circle me-1"></i> Cancelar
          </button>
          <button type="button" class="btn btn-primary" (click)="guardarCliente()">
            <i class="bi bi-save me-1"></i>
            {{ clienteEnEdicion ? 'Actualizar' : 'Guardar' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>