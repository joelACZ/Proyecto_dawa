<!-- CARD PRINCIPAL -->
<app-card
  title="Gestión de Servicios"
  subtitle="Administra los servicios ofrecidos en la plataforma"
  content="Aquí puedes crear, editar y eliminar servicios, así como gestionar sus detalles y asignaciones a profesionales.">
</app-card>

<!-- BUSCADOR + NUEVO -->
<div>
  <input
    #buscador
    type="text"
    placeholder="Buscar servicios..."
    (input)="search(buscador)"
  >

  <button (click)="create()">
    <i class="bi bi-plus-circle"></i> agregar
  </button>
</div>

<!-- TABLA REUTILIZABLE -->
<app-data-table [data]="servicios" [columns]="columns">
  <ng-template #actions let-row>
    <div class="flex gap-2">

      <button (click)="openView(row)" class="btn action-btn unified" title="Ver">
        <i class="bi bi-eye"></i>
      </button>

      <button (click)="edit(row)" class="btn action-btn unified" title="Editar">
        <i class="bi bi-pencil"></i>
      </button>

      <button (click)="delete(row)" class="btn action-btn unified" title="Eliminar">
        <i class="bi bi-trash"></i>
      </button>

    </div>
  </ng-template>
</app-data-table>

<!-- MODAL: VER SERVICIO -->
<app-detail-modal
  [isVisible]="showViewModal"
  [data]="servicioView"
  (close)="closeViewModal()">
</app-detail-modal>

<!-- MODAL: CREAR / EDITAR SERVICIO -->
<div *ngIf="showModal" class="modal-overlay" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">

    <div class="modal-header flex justify-between items-center">
      <h3 class="flex items-center gap-2">
        <i class="bi" 
           [class.bi-pencil]="editingId"
           [class.bi-plus-circle]="!editingId"></i>

        {{ editingId ? 'Editar Servicio' : 'Nuevo Servicio' }}
      </h3>

      <button class="close-btn" (click)="closeModal()">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>

    <form [formGroup]="formServicio" (ngSubmit)="save()">

      <div class="grid gap-3">

        <div>
          <label><i class="bi bi-file-earmark-text"></i> Nombre *</label>
          <input formControlName="nombre" class="input">
        </div>

        <div>
          <label><i class="bi bi-list-ul"></i> Categoría *</label>
          <select formControlName="categoria" class="input">
            <option value="" disabled selected>Seleccione</option>
            <option *ngFor="let c of categorias" [value]="c">
              {{ c }}
            </option>
          </select>
        </div>

        <div>
          <label><i class="bi bi-card-text"></i> Descripción *</label>
          <textarea formControlName="descripcion" rows="2" class="input"></textarea>
        </div>

        <div>
          <label><i class="bi bi-cash-coin"></i> Precio Base *</label>
          <input formControlName="precioBase" type="number" class="input">
        </div>

        <div>
          <label><i class="bi bi-hourglass-split"></i> Duración (min) *</label>
          <input formControlName="duracionEstimada" type="number" class="input">
        </div>

        <div>
          <label><i class="bi bi-person-badge"></i> Profesional *</label>
          <select formControlName="profesional_id" class="input">
              <option value="0">Seleccionar profesional...</option>
              <option *ngFor="let profesional of profesionales" [value]="profesional.id">
                {{ profesional.nombre }} ({{ profesional.telefono }})
            </select>
        </div>

        <div class="flex items-center gap-2">
          <input type="checkbox" formControlName="activo">
          <label><i class="bi bi-check2-square"></i> Servicio Activo</label>
        </div>

      </div>

      <!-- BOTONES -->
      <div class="flex justify-between mt-4">

        <button type="button" class="btn-cancel" (click)="closeModal()">
          <i class="bi bi-x-circle"></i> Cancelar
        </button>

        <button type="submit" class="btn-submit">
          <i class="bi" 
             [class.bi-check-circle]="!editingId"
             [class.bi-arrow-clockwise]="editingId"></i>

          {{ editingId ? 'Actualizar' : 'Crear' }}
        </button>

      </div>
    </form>
  </div>
</div>
